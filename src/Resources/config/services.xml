<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>

        <service id="postman.command.collection_build" class="PostmanGeneratorBundle\Command\PostmanCollectionBuildCommand">
            <argument type="service" id="postman.generator.collection" />
            <argument type="service" id="serializer" />
            <argument>%postman.name%</argument>
            <argument>%kernel.root_dir%</argument>
            <tag name="console.command" />
        </service>

        <service id="postman.registry.resource" class="PostmanGeneratorBundle\Registry\ResourceRegistry" />

        <service id="postman.generator.collection" class="PostmanGeneratorBundle\Generator\CollectionGenerator">
            <argument type="service" id="postman.registry.resource" />
            <argument type="service" id="postman.generator.request" />
            <argument type="service" id="postman.generator.folder" />
            <argument>%postman.public%</argument>
            <argument>%postman.name%</argument>
            <argument>%postman.description%</argument>
        </service>

        <service id="postman.generator.folder" class="PostmanGeneratorBundle\Generator\FolderGenerator" />

        <service id="postman.generator.request" class="PostmanGeneratorBundle\Generator\RequestGenerator">
            <argument type="service" id="api.mapping.class_metadata_factory" />
            <argument type="service" id="api.mapping.loaders.attributes" />
            <argument type="service" id="postman.generator.authentication" />
            <argument type="service" id="postman.guesser" />
            <argument type="service" id="postman.parser.factory" />
            <argument type="service" id="annotation_reader" />
            <argument>%postman.authentication%</argument>
        </service>

        <service id="postman.generator.authentication" class="PostmanGeneratorBundle\Generator\AuthenticationGenerator" />

        <service id="postman.authenticator.oauth2" class="PostmanGeneratorBundle\Authenticator\OAuth2Authenticator">
            <tag name="postman.authenticator" alias="oauth2" />
        </service>

        <service id="postman.authenticator.jwt" class="PostmanGeneratorBundle\Authenticator\JwtAuthenticator">
            <tag name="postman.authenticator" alias="jwt" />
        </service>

        <service id="postman.normalizer.request" class="PostmanGeneratorBundle\Normalizer\RequestNormalizer" public="false">
            <tag name="serializer.normalizer" />
        </service>

        <service id="postman.normalizer.folder" class="PostmanGeneratorBundle\Normalizer\FolderNormalizer" public="false">
            <tag name="serializer.normalizer" />
        </service>

        <service id="postman.faker.factory" class="Faker\Factory" />

        <service id="postman.faker" class="Faker\Generator">
            <factory service="postman.faker.factory" method="create" />
            <argument>%postman.defaultlocale%</argument>
        </service>

        <service id="postman.guesser" class="PostmanGeneratorBundle\Faker\Guesser\Guesser">
            <argument type="service" id="postman.faker" />
            <argument type="service" id="api.iri_converter" />
            <argument type="service" id="api.resource_collection" />
            <argument type="service" id="api.mapping.class_metadata_factory" />
        </service>

        <service id="postman.parser.factory" class="PostmanGeneratorBundle\RequestParser\RequestParserFactory" />

        <service id="postman.parser.uri" class="PostmanGeneratorBundle\RequestParser\UriRequestParser">
            <argument>%postman.baseUrl%</argument>
            <tag name="postman.request_parser" />
        </service>

    </services>

</container>
